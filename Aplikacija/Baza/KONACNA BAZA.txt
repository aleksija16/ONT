CREATE TABLE `organizacija`.`vodici` (
  `IdVodica` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `ImeVodica` VARCHAR(45) NOT NULL,
  `PrezimeVodica` VARCHAR(45) NOT NULL,
  `Pol` VARCHAR(1) NOT NULL,
  `BrojTelefona` VARCHAR(45) NULL,
  `Licenca` VARCHAR(45) NULL,
  `Ocena` DECIMAL(2,2) NULL,
  PRIMARY KEY (`IdVodica`),
  UNIQUE INDEX `IdVodica_UNIQUE` (`IdVodica` ASC));
ALTER TABLE `organizacija`.`vodici` 
ADD COLUMN `DatumRodjenja` DATE NULL AFTER `Ocena`;
ALTER TABLE `organizacija`.`vodici` 
ADD COLUMN `Email` VARCHAR(45) NULL AFTER `DatumRodjenja`;

CREATE TABLE `organizacija`.`turisti` (
  `IdTuriste` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `ImeTuriste` VARCHAR(45) NOT NULL,
  `PrezimeTuriste` VARCHAR(45) NOT NULL,
  `Pol` VARCHAR(1) NULL,
  `DatumRodjenja` DATE NULL,
  `Email` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`IdTuriste`),
  UNIQUE INDEX `IdTuriste_UNIQUE` (`IdTuriste` ASC));

CREATE TABLE `organizacija`.`ture` (
  `IdTure` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `NazivTure` VARCHAR(45) NOT NULL,
  `DanOdrzavanja` VARCHAR(45) NULL,
  `VremeOdrzavanja` VARCHAR(45) NULL,
  `MestoPolaska` VARCHAR(45) NULL,
  `Kapacitet` INT UNSIGNED NULL,
  `IdVodica` INT UNSIGNED NULL,
  `Opis` VARCHAR(5000) NULL,
  PRIMARY KEY (`IdTure`),
  UNIQUE INDEX `IdTure_UNIQUE` (`IdTure` ASC),
  UNIQUE INDEX `IdVodica_UNIQUE` (`IdVodica` ASC),
  CONSTRAINT `IdVodica`
    FOREIGN KEY (`IdVodica`)
    REFERENCES `organizacija`.`vodici` (`IdVodica`)
    ON DELETE SET NULL
    ON UPDATE NO ACTION);
ALTER TABLE `organizacija`.`ture` 
ADD COLUMN `TipTure` VARCHAR(1) NOT NULL AFTER `Opis`;

CREATE TABLE `organizacija`.`znamenitosti` (
  `IdZnamenitosti` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `NazivZnamenitosti` VARCHAR(45) NOT NULL,
  `Lokacija` VARCHAR(100) NULL,
  `Opis` TEXT(10000) NULL,
  `RadnoVreme` VARCHAR(500) NULL,
  `BrojTelefona` VARCHAR(45) NULL,
  `CenaUlaznice` VARCHAR(45) NULL,
  PRIMARY KEY (`IdZnamenitosti`),
  UNIQUE INDEX `IdZnamenitosti_UNIQUE` (`IdZnamenitosti` ASC));

CREATE TABLE `organizacija`.`kvizovi` (
  `IdKviza` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `NazivKviza` VARCHAR(45) NOT NULL,
  `IdZnamenitostiK` int unsigned DEFAULT NULL,
  PRIMARY KEY (`IdKviza`),
  UNIQUE INDEX `IdKviza_UNIQUE` (`IdKviza` ASC),
  KEY `IdZnamenitosti_idx` (`IdZnamenitostiK`),
  CONSTRAINT `IdZnamenitostiK` 
    FOREIGN KEY (`IdZnamenitostiK`) 
    REFERENCES `znamenitosti` (`IdZnamenitosti`) 
    ON DELETE SET NULL
    ON UPDATE NO ACTION);

CREATE TABLE `organizacija`.`pitanja` (
  `IdPitanja` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `TekstPitanja` VARCHAR(1000) NOT NULL,
  `OdgovorA` VARCHAR(1000) NOT NULL,
  `OdgovorB` VARCHAR(1000) NOT NULL,
  `OdgovorC` VARCHAR(1000) NOT NULL,
  `TacanOdgovor` VARCHAR(1000) NOT NULL,
  `IdZnamenitosti` INT UNSIGNED NULL,
  `IdKviza` INT UNSIGNED NULL,
  PRIMARY KEY (`IdPitanja`),
  UNIQUE INDEX `IdPitanja_UNIQUE` (`IdPitanja` ASC),
  KEY `IdKviza_idx` (`IdKviza`),
  KEY `IdZnamenitosti_idx` (`IdZnamenitosti`),
  CONSTRAINT `IdZnamenitosti`
    FOREIGN KEY (`IdZnamenitosti`)
    REFERENCES `organizacija`.`znamenitosti` (`IdZnamenitosti`)
    ON DELETE SET NULL
    ON UPDATE NO ACTION,
  CONSTRAINT `IdKviza`
    FOREIGN KEY (`IdKviza`)
    REFERENCES `organizacija`.`kvizovi` (`IdKviza`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION);

CREATE TABLE `organizacija`.`halloffame` (
  `IdHallOfFame` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `IdTuristeHof` INT UNSIGNED NULL,
  `IdKvizaHof` INT UNSIGNED NULL,
  `Poeni` INT NOT NULL,
  `DatumRadjenja` DATE NULL,
  PRIMARY KEY (`IdHallOfFame`),
  UNIQUE INDEX `IdHallOfFame_UNIQUE` (`IdHallOfFame` ASC),
  UNIQUE INDEX `IdTuriste_UNIQUE` (`IdTuristeHof` ASC),
  UNIQUE INDEX `IdKviza_UNIQUE` (`IdKvizaHof` ASC),
  CONSTRAINT `IdTuristeHof`
    FOREIGN KEY (`IdTuristeHof`)
    REFERENCES `organizacija`.`turisti` (`IdTuriste`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `IdKvizaHof`
    FOREIGN KEY (`IdKvizaHof`)
    REFERENCES `organizacija`.`kvizovi` (`IdKviza`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

CREATE TABLE `organizacija`.`znamenitostiuturama` (
  `IdZnamenitostiZut` INT UNSIGNED NOT NULL,
  `IdTureZut` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`IdZnamenitostiZut`, `IdTureZut`),
  UNIQUE INDEX `IdZnamenitosti_UNIQUE` (`IdZnamenitostiZut` ASC),
  UNIQUE INDEX `IdTure_UNIQUE` (`IdTureZut` ASC),
  CONSTRAINT `IdZnamenitostiZut`
    FOREIGN KEY (`IdZnamenitostiZut`)
    REFERENCES `organizacija`.`znamenitosti` (`IdZnamenitosti`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `IdTureZut`
    FOREIGN KEY (`IdTureZut`)
    REFERENCES `organizacija`.`ture` (`IdTure`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

CREATE TABLE `organizacija`.`rezervacije` (
  `IdRezervacije` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `IdTuristeR` INT UNSIGNED NULL,
  `IdTureR` INT UNSIGNED NULL,
  `IdVodicaR` INT UNSIGNED NULL,
  `Datum` DATE NULL,
  `BrojOsoba` int unsigned DEFAULT NULL,
  PRIMARY KEY (`IdRezervacije`),
  UNIQUE INDEX `IdRezervacije_UNIQUE` (`IdRezervacije` ASC),
  UNIQUE INDEX `IdTuristeR_UNIQUE` (`IdTuristeR` ASC),
  UNIQUE INDEX `IdTureR_UNIQUE` (`IdTureR` ASC),
  UNIQUE INDEX `IdVodicaR_UNIQUE` (`IdVodicaR` ASC),
  CONSTRAINT `IdTuristeR`
    FOREIGN KEY (`IdTuristeR`)
    REFERENCES `organizacija`.`turisti` (`IdTuriste`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `IdTureR`
    FOREIGN KEY (`IdTureR`)
    REFERENCES `organizacija`.`ture` (`IdTure`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `IdVodicaR`
    FOREIGN KEY (`IdVodicaR`)
    REFERENCES `organizacija`.`vodici` (`IdVodica`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

CREATE TABLE `organizacija`.`ocenjivanjevodica` (
  `IdOcenjivanja` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `IdVodicaO` INT UNSIGNED NULL,
  `IdTuristeO` INT UNSIGNED NULL,
  `IdTureO` INT UNSIGNED NULL,
  `Ocena` INT NOT NULL,
  PRIMARY KEY (`IdOcenjivanja`),
  UNIQUE INDEX `IdOcenjivanja_UNIQUE` (`IdOcenjivanja` ASC),
  UNIQUE INDEX `IdVodicaO_UNIQUE` (`IdVodicaO` ASC),
  UNIQUE INDEX `IdTuristeO_UNIQUE` (`IdTuristeO` ASC),
  UNIQUE INDEX `IdTureO_UNIQUE` (`IdTureO` ASC),
  CONSTRAINT `IdVodicaO`
    FOREIGN KEY (`IdVodicaO`)
    REFERENCES `organizacija`.`vodici` (`IdVodica`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  CONSTRAINT `IdTuristeO`
    FOREIGN KEY (`IdTuristeO`)
    REFERENCES `organizacija`.`turisti` (`IdTuriste`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `IdTureO`
    FOREIGN KEY (`IdTureO`)
    REFERENCES `organizacija`.`ture` (`IdTure`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

CREATE TABLE `organizacija`.`korisnici` (
  `IdKorisnika` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `Username` VARCHAR(45) NOT NULL,
  `Password` VARCHAR(45) NOT NULL,
  `TipKorisnika` VARCHAR(1) NOT NULL,
  `IdVodicaK` INT UNSIGNED NULL,
  `IdTuristeK` INT UNSIGNED NULL,
  PRIMARY KEY (`IdKorisnika`),
  UNIQUE INDEX `IdKorisnika_UNIQUE` (`IdKorisnika` ASC),
  UNIQUE INDEX `Username_UNIQUE` (`Username` ASC),
  UNIQUE INDEX `IdVodicaK_UNIQUE` (`IdVodicaK` ASC),
  UNIQUE INDEX `IdTuristeK_UNIQUE` (`IdTuristeK` ASC),
  CONSTRAINT `IdVodicaK`
    FOREIGN KEY (`IdVodicaK`)
    REFERENCES `organizacija`.`vodici` (`IdVodica`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `IdTuristeK`
    FOREIGN KEY (`IdTuristeK`)
    REFERENCES `organizacija`.`turisti` (`IdTuriste`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

-----BAZA ZA ANKETU-------

CREATE TABLE `organizacija`.`anketa` (
  `IdAnkete` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `IdTuristeAnk` INT UNSIGNED NOT NULL,
  `IdTureAnk` INT UNSIGNED NULL,
  `IdVodicaAnk` INT UNSIGNED NULL,
  `KonacnaOcena` INT UNSIGNED NULL,
  `VremenskiUslovi` VARCHAR(45) NULL,
  `Komentar` VARCHAR(1000) NULL,
  `OrganizovanostTure` INT UNSIGNED NULL,
  `InformisanostVodica` INT UNSIGNED NULL,
  `FizickaZahtevnostTure` INT UNSIGNED NULL,
  `TipTuriste` VARCHAR(45) NULL,
  `DrustvenaAtmosfera` VARCHAR(45) NULL,
  `NajinteresantnijaZnamenitost` VARCHAR(45) NULL,
  `NajdosadnijaZnamenitost` VARCHAR(45) NULL,
  PRIMARY KEY (`IdAnkete`),
  UNIQUE INDEX `idankete_UNIQUE` (`IdAnkete` ASC),
  INDEX `IdTuristeAnk_idx` (`IdTuristeAnk` ASC),
  INDEX `IdTureAnk_idx` (`IdTureAnk` ASC),
  INDEX `IdVodicaAnk_idx` (`IdVodicaAnk` ASC),
  CONSTRAINT `IdTuristeAnk`
    FOREIGN KEY (`IdTuristeAnk`)
    REFERENCES `organizacija`.`turisti` (`IdTuriste`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `IdTureAnk`
    FOREIGN KEY (`IdTureAnk`)
    REFERENCES `organizacija`.`ture` (`IdTure`)
    ON DELETE SET NULL
    ON UPDATE NO ACTION,
  CONSTRAINT `IdVodicaAnk`
    FOREIGN KEY (`IdVodicaAnk`)
    REFERENCES `organizacija`.`vodici` (`IdVodica`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION);
